<div class="page" animate.enter="slide-horizontal-in" animate.leave="slide-horizontal-out">
    <page-header [title]="'Prontuário'" [returnUrl]="'pacientes'">
        <!-- <div class="d-flex gap items-center">
        </div> -->
        <div class="w-full d-flex gap items-center flex-wrap">
            <button class="secondary h-full flex-1-1" (click)="modalOpen = true">Novo prontuário</button>
        </div>
    </page-header>
    <div class="d-flex flex-col gap">
        <div class="d-flex gap items-center justify-between flex-wrap">
            <div class="d-flex flex-col gap-4">
                <h3 animate.enter="slide-vertical-in" class="text-text text-size-40"
                    *skeleton="isLoading(); className: ['w-60-p', 'h-64']">{{patient()?.fullName}}</h3>

                <p class="text-placeholder" *skeleton="isLoading(); className: ['w-40-p', 'h-24']">{{patient()?.age}}
                    anos, {{patient()?.address?.city}} -
                    {{patient()?.address?.state}}</p>
            </div>
            <div class="d-flex gap-16">
                <button data-tooltip-bottom="Baixar em PDF" class="circle surface w-40 h-40 p-24"
                    (click)="printRecords()">
                    <span class="material-symbols-outlined">
                        download
                    </span>
                </button>
                <button data-tooltip-bottom="Imprimir" class="circle surface w-40 h-40 p-24"
                    (click)="printRecords()">
                    <span class="material-symbols-outlined">
                        print
                    </span>
                </button>
            </div>
        </div>
        <div class="d-flex flex-col w-full gap-40">
            <div class="w-full d-flex gap justify-between flex-wrap items-center">
                <h3 class="text-size-24 text-placeholder">Histórico do paciente</h3>
                <div class="max-w-248">
                    <input type="date" [(ngModel)]="today" name="date" />
                </div>
            </div>
            <div class="d-flex flex-col w-full" *skeleton="isLoading(); className: ['w-full', 'min-h-240']; size: 4"
                animate.enter="slide-vertical-in">

                <ng-container *ngIf="patient()?.records?.length">
                    <div *ngFor="let record of patient()?.records; let i = index"
                        class="d-flex flex-col gap-40 items-center justify-center w-full"
                        [animate.enter]="'slide-vertical-in'">
                        <div class="d-flex flex-col gap-8 w-full items-center">
                            <span class="text-size-24 text-bold text-placeholder">
                                {{record.date | CustomDate}}
                            </span>
                            <hr />
                        </div>
                        <div *ngFor="let r of record.records; let j = index"
                            class="w-full d-flex flex-col gap-8 items-center" [animate.enter]="'slide-vertical-in'">
                            <div class="record-content card p-0 w-full min-h-128 flat">
                                <rich-text-viewer [content]="r.content" class="surface"></rich-text-viewer>
                            </div>
                            <div class="d-flex justify-between w-full px-16 gap">
                                <span class="text-size-12 text-placeholder">{{r.date | date:"HH:mm"}}</span>
                                <span class="text-size-18 text-placeholder">
                                    - {{r.author}}
                                </span>
                            </div>
                        </div>
                    </div>
                </ng-container>
                <ng-container *ngIf="!patient()?.records?.length">
                    <div class="card flat text-center w-full">
                        <span class="text-placeholder">
                            Nenhum histórico encontrado
                        </span>
                    </div>
                </ng-container>
            </div>
        </div>
    </div>
</div>

@if(modalOpen) {
<modal [(open)]="modalOpen" [title]="selectedRecord ? 'Editar prontuário' : 'Novo prontuário'">
    <new-record></new-record>
</modal>
}